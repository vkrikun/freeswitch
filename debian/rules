#!/usr/bin/make -f
# -*- makefile -*-
#export DH_VERBOSE=1

export CFLAGS=-ggdb3 -O2
export CXXFLAGS=-ggdb3 -O2

.PHONY: binary-quicktest

override_dh_auto_clean:
	dh_clean

.stamp-bootstrap:
	./bootstrap.sh -j
	touch $@

.stamp-configure: .stamp-bootstrap
	cp debian/modules_.conf modules.conf
	./configure -C --enable-portable-binary --disable-dependency-tracking \
		--host=$(DEB_HOST_GNU_TYPE) --build=$(DEB_BUILD_GNU_TYPE) \
		--with-gnu-ld --with-python --with-erlang --with-openssl \
		--enable-core-odbc-support --enable-zrtp \
		--prefix=/usr --localstatedir=/var \
		--sysconfdir=/etc/freeswitch \
		--with-modinstdir=/usr/lib/freeswitch/mod \
		--with-rundir=/var/run/freeswitch \
		--with-logfiledir=/var/log/freeswitch \
		--with-dbdir=/var/lib/freeswitch/db \
		--with-htdocsdir=/usr/share/freeswitch/htdocs \
		--with-soundsdir=/usr/share/freeswitch/sounds \
		--with-grammardir=/usr/share/freeswitch/grammar \
		--with-scriptdir=/usr/share/freeswitch/scripts \
		--with-recordingsdir=/var/lib/freeswitch/recordings
	touch $@

override_dh_auto_configure: .stamp-configure

.stamp-build: .stamp-configure
	make -j
	touch $@

override_dh_auto_build: .stamp-build

override_dh_auto_test:

override_dh_strip:
	dh_strip -a -k
	./debian/create-dbg-pkgs.sh

override_dh_auto_install:
	dh_auto_install
	DESTDIR=debian/tmp make cd-sounds-install cd-moh-install

override_dh_installinit:
	dh_installinit -pfreeswitch-sysvinit --name=freeswitch

debian-bootstrap: debian/.stamp-bootstrap
debian/.stamp-bootstrap:
	(cd debian && ./bootstrap.sh)
	touch $@

%: debian/.stamp-bootstrap
	dh $@

binary-quicktest:
	echo "applications/mod_commands" > debian/modules.conf
	(cd debian && ./bootstrap.sh)
	dh binary -Nfreeswitch-sounds-music -Nfreeswitch-sounds-en-us -Nfreeswitch-sounds-en-us-callie

